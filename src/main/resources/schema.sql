-- Schema for UPeU Agreements Management System
-- Based on Laravel migrations converted to SQL

CREATE TABLE IF NOT EXISTS facultads (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_facultad VARCHAR(100) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS carreras (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_carrera VARCHAR(255) NOT NULL,
    facultad_id BIGINT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (facultad_id) REFERENCES facultads(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS entidads (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_entidad VARCHAR(200) NOT NULL,
    logo VARCHAR(255),
    ubicacion VARCHAR(200) NOT NULL,
    contacto VARCHAR(100) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    email_verified_at TIMESTAMP NULL,
    password VARCHAR(255) NOT NULL,
    remember_token VARCHAR(100),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS convenios (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_convenio VARCHAR(255) NOT NULL,
    descripcion TEXT,
    fecha_inicio DATE NOT NULL,
    fecha_fin DATE,
    estado ENUM('VIGENTE', 'VENCIDO', 'POR_VENCER') NOT NULL,
    alcance ENUM('CARRERA', 'FACULTAD', 'UNIVERSIDAD') NOT NULL,
    convenio_creador BIGINT NOT NULL,
    convenio_id_entidad BIGINT NOT NULL,
    facultad_id BIGINT,
    carrera_id BIGINT,
    ambito_1 ENUM('INVESTIGACION', 'PRACTICAS_PROFESIONALES', 'TRANSFERENCIA_TECNOLOGICA', 'MOVILIDAD_ACADEMICA', 'CAPACITACION', 'DESARROLLO_PROYECTOS', 'INTERCAMBIO_CULTURAL', 'RESPONSABILIDAD_SOCIAL', 'INNOVACION', 'EMPRENDIMIENTO', 'SERVICIOS_TECNOLOGICOS', 'CONSULTORIA', 'EDUCACION_CONTINUA', 'DESARROLLO_SOSTENIBLE', 'VINCULACION_EMPRESARIAL', 'INTERNACIONALIZACION', 'PUBLICACIONES', 'EVENTOS_ACADEMICOS', 'OTROS'),
    ambito_2 ENUM('INVESTIGACION', 'PRACTICAS_PROFESIONALES', 'TRANSFERENCIA_TECNOLOGICA', 'MOVILIDAD_ACADEMICA', 'CAPACITACION', 'DESARROLLO_PROYECTOS', 'INTERCAMBIO_CULTURAL', 'RESPONSABILIDAD_SOCIAL', 'INNOVACION', 'EMPRENDIMIENTO', 'SERVICIOS_TECNOLOGICOS', 'CONSULTORIA', 'EDUCACION_CONTINUA', 'DESARROLLO_SOSTENIBLE', 'VINCULACION_EMPRESARIAL', 'INTERNACIONALIZACION', 'PUBLICACIONES', 'EVENTOS_ACADEMICOS', 'OTROS'),
    ambito_3 ENUM('INVESTIGACION', 'PRACTICAS_PROFESIONALES', 'TRANSFERENCIA_TECNOLOGICA', 'MOVILIDAD_ACADEMICA', 'CAPACITACION', 'DESARROLLO_PROYECTOS', 'INTERCAMBIO_CULTURAL', 'RESPONSABILIDAD_SOCIAL', 'INNOVACION', 'EMPRENDIMIENTO', 'SERVICIOS_TECNOLOGICOS', 'CONSULTORIA', 'EDUCACION_CONTINUA', 'DESARROLLO_SOSTENIBLE', 'VINCULACION_EMPRESARIAL', 'INTERNACIONALIZACION', 'PUBLICACIONES', 'EVENTOS_ACADEMICOS', 'OTROS'),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (convenio_creador) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (convenio_id_entidad) REFERENCES entidads(id) ON DELETE CASCADE,
    FOREIGN KEY (facultad_id) REFERENCES facultads(id) ON DELETE CASCADE,
    FOREIGN KEY (carrera_id) REFERENCES carreras(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS documento_convenios (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    nombre_archivo VARCHAR(255) NOT NULL,
    tipo_documento ENUM('PDF', 'IMAGEN', 'OTRO') NOT NULL,
    fecha_subida DATE NOT NULL,
    hora_subida TIME NOT NULL,
    convenio_id BIGINT NOT NULL,
    ruta VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (convenio_id) REFERENCES convenios(id) ON DELETE CASCADE
);